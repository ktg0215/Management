const { Pool } = require('pg');
require('dotenv').config();
const bcrypt = require('bcryptjs');

const pool = new Pool({
  connectionString: process.env.DATABASE_URL?.trim(),
});

async function createTestUsers() {
  const client = await pool.connect();
  try {
    console.log('ğŸ“§ ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆä¸­...');
    
    // åº—èˆ—IDã‚’å–å¾—ï¼ˆæœ€åˆã®åº—èˆ—ã‚’ä½¿ç”¨ï¼‰
    const storeResult = await client.query('SELECT id FROM stores LIMIT 1');
    if (storeResult.rows.length === 0) {
      console.error('âŒ åº—èˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«åº—èˆ—ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚');
      process.exit(1);
    }
    const storeId = storeResult.rows[0].id;
    console.log(`âœ… åº—èˆ—ID: ${storeId}ã‚’ä½¿ç”¨ã—ã¾ã™`);
    
    // ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©
    const testUsers = [
      {
        employeeId: 'test_user_1',
        email: 'test_user_1@example.com',
        fullName: 'ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼1',
        nickname: 'ãƒ†ã‚¹ãƒˆ1',
        password: 'test1234',
        role: 'user',
        storeId: storeId
      },
      {
        employeeId: 'test_user_2',
        email: 'test_user_2@example.com',
        fullName: 'ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼2',
        nickname: 'ãƒ†ã‚¹ãƒˆ2',
        password: 'test1234',
        role: 'user',
        storeId: storeId
      },
      {
        employeeId: 'test_admin_1',
        email: 'test_admin_1@example.com',
        fullName: 'ãƒ†ã‚¹ãƒˆç®¡ç†è€…1',
        nickname: 'ç®¡ç†è€…1',
        password: 'admin1234',
        role: 'admin',
        storeId: storeId
      },
      {
        employeeId: 'test_super_admin',
        email: 'test_super_admin@example.com',
        fullName: 'ãƒ†ã‚¹ãƒˆç·ç®¡ç†è€…',
        nickname: 'ç·ç®¡ç†è€…',
        password: 'super1234',
        role: 'super_admin',
        storeId: storeId
      }
    ];
    
    for (const user of testUsers) {
      // æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯
      const existingUser = await client.query(
        'SELECT id FROM employees WHERE email = $1 OR employee_id = $2',
        [user.email, user.employeeId]
      );
      
      if (existingUser.rows.length > 0) {
        console.log(`âš ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼ ${user.email} ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™ã€‚ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚`);
        continue;
      }
      
      // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ã‚’ç”Ÿæˆ
      const passwordHash = await bcrypt.hash(user.password, 10);
      
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ
      const result = await client.query(
        `INSERT INTO employees (employee_id, email, password_hash, full_name, nickname, store_id, role, is_active)
         VALUES ($1, $2, $3, $4, $5, $6, $7, true)
         RETURNING id, employee_id, email, full_name, nickname, role`,
        [user.employeeId, user.email, passwordHash, user.fullName, user.nickname, user.storeId, user.role]
      );
      
      console.log(`âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆæˆåŠŸ: ${user.email} (${user.role})`);
      console.log(`   ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: ${user.password}`);
    }
    
    console.log('\nğŸ“‹ ä½œæˆã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§:');
    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” CSVå‡ºåŠ›æ©Ÿèƒ½ã€ä¸€æ‹¬å‰Šé™¤æ©Ÿèƒ½ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ãªã©ã®ãƒ†ã‚¹ãƒˆã‚’è¡Œã„ã¾ã™ã€‚');
    
    for (const user of testUsers) {
      console.log(`\n${user.role === 'user' ? 'ğŸ‘¤' : user.role === 'admin' ? 'ğŸ‘¨â€ğŸ’¼' : 'ğŸ‘‘'} ${user.role.toUpperCase()}:`);
      console.log(`   ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹: ${user.email}`);
      console.log(`   ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: ${user.password}`);
    }
    
    console.log('\nâœ… ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆå®Œäº†');
  } catch (err) {
    console.error('âŒ ã‚¨ãƒ©ãƒ¼:', err);
    process.exit(1);
  } finally {
    client.release();
    await pool.end();
  }
}

createTestUsers();

