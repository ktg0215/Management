# 支払い管理機能 ブラウザデバッグ手順

## 事前準備
- バックエンドサーバー: http://localhost:3001 (起動済み)
- フロントエンドサーバー: http://localhost:3000 (起動済み)
- テストデータ: 作成済み

## デバッグ確認項目

### 1. ログイン確認
1. http://localhost:3000/login にアクセス
2. 管理者アカウントでログイン:
   - ID: 0001
   - パスワード: admin2024

### 2. 支払い管理画面での店舗別データ確認

#### 2-1. 基本画面表示
1. 管理画面 → 支払い管理 に移動
2. 店舗選択ドロップダウンに「Manager」が表示されていないことを確認
3. 任意の店舗を選択（例：東京本店）

#### 2-2. 企業一覧表示確認
**東京本店を選択した場合の期待値:**
- ABC広告代理店（共通企業）
- 東京電力エナジーパートナー（共通企業）
- NTTコミュニケーションズ（共通企業）
- 東京清掃サービス（東京本店固有）
- 東京セキュリティ（東京本店固有）
- 東京配送センター（東京本店固有）

#### 2-3. 他店舗との比較確認
**札幌支店を選択した場合の期待値:**
- ABC広告代理店（共通企業）
- 東京電力エナジーパートナー（共通企業）
- NTTコミュニケーションズ（共通企業）
- 北海道美装（札幌支店固有）
- 北海道セキュリティ（札幌支店固有）
- 北海道配送（札幌支店固有）

### 3. 支払いデータの保存・編集テスト

#### 3-1. 新規データ保存
1. 東京本店を選択
2. 任意の企業（例：ABC広告代理店）を選択
3. 2024-07月に金額を入力（例：150,000円）
4. 保存ボタンクリック
5. データが保存されることを確認

#### 3-2. データ編集
1. 保存済みデータの金額を変更（例：160,000円）
2. 保存ボタンクリック
3. 変更が反映されることを確認

#### 3-3. 店舗間データ分離確認
1. 東京本店でABC広告代理店に支払いデータを入力
2. 札幌支店に切り替え
3. 同じABC広告代理店を見る
4. 東京本店で入力したデータが表示されないことを確認
5. 札幌支店で別の金額を入力
6. 東京本店に戻って、札幌支店のデータが表示されないことを確認

### 4. 確認すべきポイント

#### ✅ 正常動作の確認項目
- [ ] 店舗選択で企業一覧が切り替わる
- [ ] 同名企業が店舗別に表示される
- [ ] 固有企業が正しい店舗にのみ表示される
- [ ] 支払いデータが正しく保存される
- [ ] 支払いデータが正しく更新される
- [ ] 他店舗のデータが混在しない
- [ ] Managerストアが表示されない

#### ⚠️ 問題が発生する可能性のある箇所
- 店舗切り替え時のデータクリア
- 同名企業の識別（store_id付きで区別）
- 支払いデータの store_id 保存
- フロントエンドでの店舗フィルタリング

### 5. エラー確認方法
1. ブラウザの開発者ツール（F12）でコンソールエラーを確認
2. ネットワークタブでAPIレスポンスを確認
3. バックエンドのターミナルでサーバーログを確認

### 6. データベース直接確認コマンド
```bash
# 支払いテーブルの内容確認
node check-payments-table.js

# 企業テーブルの店舗別確認  
node debug-payment-store-logic.js
```

## 想定される課題と対策

### 課題1: 企業リストが切り替わらない
**原因**: フロントエンドの店舗フィルタリング不具合
**確認**: `/api/companies?store_id=XXX` のレスポンス

### 課題2: 支払いデータが他店舗と混在
**原因**: store_id の保存・取得ロジック不具合
**確認**: `/api/payments?store_id=XXX&month=2024-07` のレスポンス

### 課題3: 同名企業の区別ができない
**原因**: フロントエンドで company_id の代わりに name で識別
**確認**: 企業選択時のcompany_idの正確性 