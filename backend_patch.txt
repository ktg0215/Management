    // 月次売上管理（monthly_sales）テーブルにも自動反映
    try {
      const monthlyExistingResult = await pool!.query(
        'SELECT id FROM monthly_sales WHERE store_id = $1 AND year = $2 AND month = $3',
        [storeId, year, month]
      );

      if (monthlyExistingResult.rows.length > 0) {
        // 既存データを更新
        await pool!.query(
          `UPDATE monthly_sales
           SET daily_data = $1, updated_at = NOW()
           WHERE store_id = $2 AND year = $3 AND month = $4`,
          [JSON.stringify(dailyData), storeId, year, month]
        );
      } else {
        // 新規作成
        await pool!.query(
          `INSERT INTO monthly_sales (store_id, year, month, daily_data, created_at, updated_at)
           VALUES ($1, $2, $3, $4, NOW(), NOW())`,
          [storeId, year, month, JSON.stringify(dailyData)]
        );
      }
      console.log(`✅ 月次売上管理テーブルへの自動反映完了: store_id=${storeId}, year=${year}, month=${month}`);
    } catch (syncErr) {
      console.error('⚠️ 月次売上管理テーブルへの反映でエラー（メイン処理は成功）:', syncErr);
      // メイン処理は成功しているのでエラーを返さない
    }

    res.json({ success: true, message: '売上データが正常に保存されました（月次売上管理にも反映）' });
